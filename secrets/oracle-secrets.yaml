id: "oracle-cloud-secrets-001"
name: "Oracle Cloud Infrastructure Secrets Detection"
description: "Detects Oracle Cloud API keys, configuration files, and credentials in source code"
category: "secrets"
severity: "critical"
author: "Valkyrie Community"
version: "1.0.0"
tags:
  - "oracle"
  - "oci"
  - "oracle-cloud"
  - "api-keys"
  - "secrets"
  - "cloud"
  - "enterprise"
enabled: true

# Pattern definitions
patterns:
  - pattern: '-----BEGIN PRIVATE KEY-----(.|\n){1,1000}-----END PRIVATE KEY-----'
    name: "OCI Private Key pattern"
    entropy_threshold: 0.0
    keywords: ["oracle", "oci", "private", "key", "rsa", "pem"]

  - pattern: '\[DEFAULT\](\n.*)*key_file\s*=\s*[^\n]+'
    name: "OCI Config key_file reference"
    entropy_threshold: 0.0
    keywords: ["oci", "oracle", "config", "key_file", "default"]

  - pattern: '\[DEFAULT\](\n.*)*fingerprint\s*=\s*[0-9a-f:]{47}'
    name: "OCI API Key fingerprint"
    entropy_threshold: 0.0
    keywords: ["oci", "fingerprint", "api", "key", "default"]

  - pattern: '\[DEFAULT\](\n.*)*tenancy\s*=\s*ocid1\.tenancy\.oc1\.[0-9a-zA-Z_-]{60}'
    name: "OCI Tenancy OCID"
    entropy_threshold: 0.0
    keywords: ["oci", "tenancy", "ocid", "default"]

  - pattern: 'ocid1\.(user|tenancy|compartment|group)\.oc1\.[0-9a-zA-Z_-]{60}'
    name: "OCI Resource OCID pattern"
    entropy_threshold: 3.2
    keywords: ["ocid", "oci", "oracle", "cloud"]

  - pattern: '\[DEFAULT\](\n.*)*pass_phrase\s*=\s*[^\n]+'
    name: "OCI Private key pass phrase"
    entropy_threshold: 0.0
    keywords: ["oci", "pass_phrase", "passphrase", "private", "key"]

  - pattern: 'customer_secret_key\s*=\s*[A-Za-z0-9/+]{20,}'
    name: "OCI Customer Secret Key"
    entropy_threshold: 3.5
    keywords: ["customer", "secret", "key", "oci"]

  - pattern: 'auth_token\s*=\s*[A-Za-z0-9_-]{30,}'
    name: "OCI Auth Token"
    entropy_threshold: 3.8
    keywords: ["auth", "token", "oci", "oracle"]

# File type restrictions
file_extensions:
  - ".config"
  - ".conf"
  - ".cfg"
  - ".ini"
  - ".yaml"
  - ".yml"
  - ".json"
  - ".sh"
  - ".bash"
  - ".py"
  - ".java"
  - ".pem"
  - ".key"
  - ".env"
  - ".txt"
  - ".properties"

# Exclude patterns to reduce false positives
exclude_patterns:
  - "test.*"
  - "example.*"
  - ".*template.*"
  - ".*sample.*"
  - ".*mock.*"
  - "ocid1.example.oc1..exampleexampleexample"
  - "-----BEGIN EXAMPLE PRIVATE KEY-----"

remediation: |
  Oracle Cloud Infrastructure credentials should never be hardcoded in source code.
  
  Recommended solutions:
  1. Use OCI Instance Principles for compute instances
  2. Use OCI Resource Principals for functions and containers
  3. Store secrets in OCI Vault service
  4. Use OCI CLI configuration with proper file permissions
  5. Implement OCI IAM policies with least privilege
  6. Use environment variables for development (never commit config files)
  7. Regularly rotate API keys and review security policies
  8. Use OCI Cloud Guard for security monitoring

references:
  - "https://docs.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm"
  - "https://docs.oracle.com/en-us/iaas/Content/Security/Concepts/security_guide.htm"
  - "https://docs.oracle.com/en-us/iaas/Content/API/Concepts/sdkconfig.htm"
  - "https://docs.oracle.com/en-us/iaas/Content/Identity/Concepts/credentials_guide.htm"
  - "https://docs.oracle.com/en-us/iaas/Content/KeyManagement/Concepts/keyoverview.htm"
  