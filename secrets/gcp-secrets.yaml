id: "gcp-secrets-001"
name: "Google Cloud Platform Secrets Detection"
description: "Detects GCP credentials and API keys in source code"
category: "secrets"
severity: "critical"
author: "Valkyrie Community"
version: "1.0.0"
tags:
  - "gcp"
  - "google-cloud"
  - "credentials"
  - "secrets"
enabled: true

# Pattern definitions
patterns:
  - pattern: 'AIza[0-9A-Za-z\\-_]{35}'
    name: "GCP API Key pattern"
    entropy_threshold: 0.0
    keywords: ["gcp", "google", "cloud", "api", "key"]
  
  - pattern: '"type": "service_account"'
    name: "GCP Service Account JSON indicator"
    entropy_threshold: 0.0
    keywords: ["service_account", "gcp", "google"]

  - pattern: '"private_key": "-----BEGIN PRIVATE KEY-----'
    name: "GCP Service Account Private Key"
    entropy_threshold: 0.0
    keywords: ["private_key", "rsa", "gcp"]

  - pattern: '[0-9]+-[0-9a-zA-Z_]{32}\\.apps\\.googleusercontent\\.com'
    name: "Google OAuth Client ID"
    entropy_threshold: 0.0
    keywords: ["oauth", "client", "google"]

  - pattern: '"client_secret": "[A-Za-z0-9_\\-]{24,}"'
    name: "Google OAuth Client Secret"
    entropy_threshold: 3.8
    keywords: ["client_secret", "oauth", "google"]

# File type restrictions
file_extensions:
  - ".py"
  - ".js"
  - ".java"
  - ".go"
  - ".ts"
  - ".yaml"
  - ".yml"
  - ".json"
  - ".env"
  - ".tf"  # Terraform files often contain GCP configs
  - ".txt"

# Exclude patterns to reduce false positives
exclude_patterns:
  - "test.*"
  - "example.*"
  - ".*demo.*"
  - ".*template.*"
  - "config.*example.*"

remediation: |
  GCP credentials should never be hardcoded in source code.
  
  Recommended solutions:
  1. Use Google Cloud Secret Manager for sensitive data
  2. Use Workload Identity for GKE and Cloud Run
  3. Use environment variables for local development
  4. Use IAM roles and service accounts properly
  5. Regularly rotate keys and use key management best practices

references:
  - "https://cloud.google.com/secret-manager"
  - "https://cloud.google.com/iam/docs/best-practices"
  - "https://cloud.google.com/blog/products/identity-security/how-to-handle-gcp-service-account-keys-securely"
  - "https://cloud.google.com/docs/authentication/api-keys#securing_api_keys"